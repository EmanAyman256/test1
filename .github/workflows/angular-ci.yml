name: Build and Deploy to BTP Cloud Foundry

on:
  push:
    branches: [ main ]

jobs:
  build-and-deploy:
    runs-on: windows-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: Install dependencies
        run: npm install

      - name: Build Angular app
        run: npm run build -- --configuration production

      - name: Install Cloud Foundry CLI
        shell: powershell
        run: |
          Invoke-WebRequest -Uri "https://packages.cloudfoundry.org/stable?release=windows64" -OutFile "cf.exe"
          Move-Item cf.exe C:\cf.exe
          echo "C:\\" | Out-File -Append $env:GITHUB_PATH

      - name: Login and Deploy to BTP
        run: |
          cf api  https://api.cf.ap21.hana.ondemand.com/ 
          cf auth emanaymn207@gmail.com Eman207#234
          cf target -o 42635b4ctrial -s dev
          cf push
